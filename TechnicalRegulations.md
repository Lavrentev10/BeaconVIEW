### **Техническое задание для проекта: BLE-трекинг с использованием плат Mini D1 ESP32**

#### **1. Общие положения:**
Целью проекта является разработка системы BLE-трекинга, которая будет отслеживать местоположение меток с использованием плат Mini D1 ESP32 (на базе ESP8266). Система будет включать метки и шлюзы, которые взаимодействуют по Bluetooth для определения местоположения меток с помощью триангуляции на основе уровня сигнала (RSSI). Местоположение меток будет отображаться на статичной карте в реальном времени, обновляемой дважды в секунду.

#### **2. Система состоит из:**
1. **Метки (BLE Tags)** – устройства, которые отправляют Bluetooth-пакеты с уникальным идентификатором.
2. **Шлюзы (BLE Gateways)** – устройства, которые принимают Bluetooth-сигналы от меток, измеряют уровень сигнала (RSSI) и передают эту информацию на мастер-шлюз.
3. **Мастер-шлюз (Master Gateway)** – устройство, подключённое к компьютеру через USB, которое принимает данные от шлюзов и передает их в сервер для дальнейшей обработки.
4. **Серверная часть (Backend)** – программная часть, которая вычисляет местоположение меток по данным от шлюзов, используя алгоритм триангуляции на основе RSSI.
5. **Графический интерфейс (Frontend)** – веб-интерфейс или графический пользовательский интерфейс для отображения карты с метками и их координатами, которые обновляются дважды в секунду.

#### **3. Технические характеристики:**

1. **Метки и шлюзы:**
   - Платы: **Mini D1 ESP32** (на базе ESP8266).
   - Язык программирования: **C++**.
   - Среда разработки: **PlatformIO** в **VS Code** на Ubuntu.
   - Взаимодействие между устройствами по **Bluetooth (BLE)**.
   - Отправка пакетов с уникальным идентификатором метки.
   - Шлюзы принимают BLE-сигналы и вычисляют RSSI.
   - Шлюзы передают информацию на мастер-шлюз по **BLE GATT**.
   - Мастер-шлюз передает данные на сервер через **USB**.

2. **Серверная часть:**
   - Язык программирования: **Python** или **C++**.
   - Алгоритм вычисления местоположения меток на основе **триангуляции RSSI**.
   - Система должна учитывать координаты шлюзов, заданные перед запуском программы.
   - Расчёт местоположения метки будет обновляться **2 раза в секунду**.

3. **Графический интерфейс:**
   - Используемая библиотека: **Qt Quick (QML + C++)**.
   - Статичная карта будет представлять собой прямоугольник, в котором расположение шлюзов задается координатами при запуске программы.
   - Расположение меток на карте будет **динамическим** и обновляться дважды в секунду по вычисленным данным.
   - Интерфейс будет отображать:
     - Метки с их уникальными идентификаторами.
     - Позицию каждой метки на карте.
     - Возможность масштабирования и перемещения по карте.

#### **4. Подробности реализации:**

1. **Метки и шлюзы:**
   - **Метки** будут посылать BLE-пакеты с уникальным идентификатором.
   - **Шлюзы** принимают BLE-сигналы от меток и измеряют уровень сигнала RSSI.
   - Каждый шлюз будет передавать на мастер-шлюз пакет с информацией:
     - Идентификатор шлюза.
     - Идентификатор метки.
     - Уровень сигнала RSSI.
   - **Мастер-шлюз** будет передавать собранные данные на сервер по USB-интерфейсу.

2. **Алгоритм триангуляции:**
   - Местоположение метки будет вычисляться с использованием данных о расстоянии (по RSSI) от нескольких шлюзов.
   - Примерный уровень сигнала метки на расстоянии 1 метр будет использоваться для калибровки.
   - Для тестирования в первом этапе стены и препятствия не будут учитываться.

3. **Обработка данных на сервере:**
   - Серверная часть будет обрабатывать данные, поступающие от шлюзов.
   - В зависимости от выбранного варианта, сервер может быть написан на **Python** или **C++**.
   - Расчёты будут включать вычисление координат меток с использованием триангуляции.

4. **Графический интерфейс (Frontend):**
   - Интерфейс будет реализован с использованием **Qt Quick (QML + C++)** для динамического отображения карты и местоположения меток.
   - При старте программы задаются размеры карты и координаты шлюзов.
   - Обновление положения меток будет происходить дважды в секунду.
   - Возможности масштабирования карты и настройки отображения меток.

#### **5. Важные моменты:**

1. **Калибровка RSSI:**
   - Для каждой метки будет вычисляться уровень сигнала на расстоянии 1 метр, который будет использоваться для калибровки.

2. **Передача данных:**
   - Передача данных между шлюзами и мастер-шлюзом будет осуществляться через **BLE GATT**.
   - Мастер-шлюз передает данные на сервер через **USB**.

3. **Обновление данных в UI:**
   - Положение метки будет обновляться **2 раза в секунду**.
   - Интерфейс будет динамически отображать изменения координат меток на статичной карте.

4. **Планируемые расширения:**
   - В дальнейшем возможно добавление поддержки стен и препятствий для более точной триангуляции.
   - Расширение функционала графического интерфейса для добавления дополнительных настроек.

---

### **Заключение:**
Проект предполагает создание системы BLE-трекинга с использованием Mini D1 ESP32. Весь процесс будет включать как обработку данных, так и визуализацию меток на карте. Сервер будет вычислять местоположение меток на основе данных о уровне сигнала от шлюзов, и результаты будут отображаться в динамическом пользовательском интерфейсе с обновлением координат дважды в секунду. Система будет тестироваться без учета препятствий на первом этапе.